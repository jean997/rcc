---
title: "Linear Regression with Simulated Genotypes"
author: ""
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Linear Regression with Simulated Genotypes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE, warning=FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
library(rcc)
```

This vignette reproduces the simulations in section 3.1. These can take quite a while so it is better to run them in parallell than sequentially as shown below.

The function `run1_linreg_sim` is a wrapper to call `linreg_sim` using built-in data and parameters. It uses a matrix `population_genotypes` which contains SNP data for 500 SNPs in 10,000 individuals. These data were produced using MACS as 5 blocks of 100 SNPs.

```{r, eval=FALSE}
set.seed(5989615)
all.seeds <- floor(runif(n=400, min=1000, max=1e7))

for(beta.type in c("none", "ten_equal", "ten_norm", "mixture")){
    for(i in 1:400){
      run1_linreg_sim(beta.type=beta.type, which.run=i, file.prefix="linreg", seed=all.seeds[i])
    }
}
```

`run1_linreg` writes out one file for each simulation. Now we need to collect them all.

```{r, eval=FALSE}
for(beta.type in c("none", "ten_equal", "ten_norm", "mixture")){
    COVERAGE <- array(dim=c(5, 500, 400))
    WIDTH <- array(dim=c(5, 500, 400))
    for(i in 1:400){
      z <- rcc:::getobj(paste0("linreg_", beta.type, "_n", i, ".RData"))
      COVERAGE[, , i] <- z$COVERAGE
      WIDTH[, , i] <- z$WIDTH
    }
    simnames <- z$simnames
    Z <- list("COVERAGE"=COVERAGE, "WIDTH"=WIDTH, "simnames"=simnames)
    save(Z, file=paste0("linreg_", beta.type, ".RData"))
}
```
